2025-09-01 17:58:02,856 - __main__ - INFO - Redis初始化成功
2025-09-01 17:58:05,580 - utils.llms - INFO - 成功初始化 qwen LLM
2025-09-01 17:58:05,581 - __main__ - INFO - Chat模型初始化成功
2025-09-01 17:58:05,901 - __main__ - INFO - Checkpointer初始化成功
2025-09-01 17:58:06,876 - __main__ - INFO - Agent初始化成功
2025-09-01 17:58:06,877 - __main__ - INFO - 服务完成初始化并启动服务
2025-09-01 17:58:33,684 - __main__ - INFO - get_system_info接口，接受到前端用户请求
2025-09-01 17:58:33,701 - __main__ - INFO - 返回当前系统状态信息:sessions_count=0 active_users=[]
2025-09-01 17:58:57,220 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:test01
2025-09-01 17:58:57,223 - __main__ - ERROR - 用户 test01 的会话不存在
2025-09-01 17:59:02,292 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='test01' query='你好' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-09-01 17:59:04,617 - __main__ - INFO - 最终智能体回复结果:session_id='59b20abc-7a0e-4b21-8a8a-dae01872246b' status='completed' timestamp=1756720744.6172764 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='c470304b-6018-4c13-8de2-47d7c733086d'), HumanMessage(content='你好', additional_kwargs={}, response_metadata={}, id='2031cd23-eef8-4a89-b8d1-2d5201d39546'), AIMessage(content='你好！有什么可以帮助你的吗？', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-9e979114-4fb2-9d51-a686-a943253815c0', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--8aea6a18-ebc5-4145-9be6-9ef6a3cac4dd-0', usage_metadata={'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}})]} interrupt_data=None
2025-09-01 17:59:06,655 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:test01
2025-09-01 17:59:06,658 - __main__ - INFO - 返回当前用户的状态:user_id='test01' session_id='59b20abc-7a0e-4b21-8a8a-dae01872246b' status='completed' message=None last_query='你好' last_updated=1756720744.6188293 last_response=AgentResponse(session_id='59b20abc-7a0e-4b21-8a8a-dae01872246b', status='completed', timestamp=1756720744.6172764, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'c470304b-6018-4c13-8de2-47d7c733086d'}, {'content': '你好', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '2031cd23-eef8-4a89-b8d1-2d5201d39546', 'example': False}, {'content': '你好！有什么可以帮助你的吗？', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-9e979114-4fb2-9d51-a686-a943253815c0', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--8aea6a18-ebc5-4145-9be6-9ef6a3cac4dd-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-09-01 18:00:33,556 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='test01' query='调用工具预定如家酒店' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-09-01 18:00:34,591 - __main__ - INFO - 当前触发工具调用中断:session_id='59b20abc-7a0e-4b21-8a8a-dae01872246b' status='interrupted' timestamp=1756720834.591086 message=None result=None interrupt_data={'action_request': {'action': 'book_hotel', 'args': {'hotel_name': '如家酒店'}}, 'config': None, 'description': "准备调用 book_hotel 工具：\n- 参数为: {'hotel_name': '如家酒店'}\n\n是否允许继续？\n输入 'yes' 接受工具调用\n输入 'no' 拒绝工具调用\n输入 'edit' 修改工具参数后调用工具\n输入 'response' 不调用工具直接反馈信息", 'interrupt_type': 'unknown'}
2025-09-01 18:00:40,186 - __main__ - INFO - resume_agent接口，接受到前端用户请求:user_id='test01' session_id='59b20abc-7a0e-4b21-8a8a-dae01872246b' response_type='accept' args=None
2025-09-01 18:00:40,196 - utils.tools - INFO - response: {'type': 'accept'}
2025-09-01 18:00:40,197 - utils.tools - INFO - 工具调用已批准，执行中...
2025-09-01 18:00:40,197 - utils.tools - INFO - 调用工具: book_hotel, 参数: {'hotel_name': '如家酒店'}
2025-09-01 18:00:40,198 - utils.tools - INFO - 成功预定了在如家酒店的住宿。
2025-09-01 18:00:43,543 - __main__ - INFO - 最终智能体回复结果:session_id='59b20abc-7a0e-4b21-8a8a-dae01872246b' status='completed' timestamp=1756720843.5432322 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='c470304b-6018-4c13-8de2-47d7c733086d'), HumanMessage(content='你好', additional_kwargs={}, response_metadata={}, id='2031cd23-eef8-4a89-b8d1-2d5201d39546'), AIMessage(content='你好！有什么可以帮助你的吗？', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-9e979114-4fb2-9d51-a686-a943253815c0', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--8aea6a18-ebc5-4145-9be6-9ef6a3cac4dd-0', usage_metadata={'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='ba844127-471a-4448-a1a2-59f650261edd'), HumanMessage(content='调用工具预定如家酒店', additional_kwargs={}, response_metadata={}, id='81f9d1d4-0552-4cf8-8cdb-61986d0fefa7'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_5ebcd9359c1f4569995d3e', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 24, 'prompt_tokens': 2384, 'total_tokens': 2408, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-a15c090f-b700-9708-8816-671b3458cea4', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--34432abf-3158-4926-b968-cbf89367c017-0', tool_calls=[{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_5ebcd9359c1f4569995d3e', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2384, 'output_tokens': 24, 'total_tokens': 2408, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}), ToolMessage(content='成功预定了在如家酒店的住宿。', name='book_hotel', id='6f70b6c7-27f3-4871-9f1b-7ca481e18a6c', tool_call_id='call_5ebcd9359c1f4569995d3e'), AIMessage(content='成功预定了如家酒店的住宿。如果你还有其他需求，比如了解酒店设施、周边环境或者交通情况等，请随时告诉我。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 2439, 'total_tokens': 2470, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-e614909d-ce63-9505-9dd8-714eb8b67b58', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--eb99c62d-43e0-4ce9-a4c1-66d1a1b10397-0', usage_metadata={'input_tokens': 2439, 'output_tokens': 31, 'total_tokens': 2470, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}})]} interrupt_data=None
2025-09-01 18:00:45,573 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:test01
2025-09-01 18:00:45,577 - __main__ - INFO - 返回当前用户的状态:user_id='test01' session_id='59b20abc-7a0e-4b21-8a8a-dae01872246b' status='completed' message=None last_query='调用工具预定如家酒店' last_updated=1756720843.5451405 last_response=AgentResponse(session_id='59b20abc-7a0e-4b21-8a8a-dae01872246b', status='completed', timestamp=1756720843.5432322, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'c470304b-6018-4c13-8de2-47d7c733086d'}, {'content': '你好', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '2031cd23-eef8-4a89-b8d1-2d5201d39546', 'example': False}, {'content': '你好！有什么可以帮助你的吗？', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-9e979114-4fb2-9d51-a686-a943253815c0', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--8aea6a18-ebc5-4145-9be6-9ef6a3cac4dd-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'ba844127-471a-4448-a1a2-59f650261edd'}, {'content': '调用工具预定如家酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '81f9d1d4-0552-4cf8-8cdb-61986d0fefa7', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_5ebcd9359c1f4569995d3e', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 24, 'prompt_tokens': 2384, 'total_tokens': 2408, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-a15c090f-b700-9708-8816-671b3458cea4', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--34432abf-3158-4926-b968-cbf89367c017-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_5ebcd9359c1f4569995d3e', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2384, 'output_tokens': 24, 'total_tokens': 2408, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '成功预定了在如家酒店的住宿。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': '6f70b6c7-27f3-4871-9f1b-7ca481e18a6c', 'tool_call_id': 'call_5ebcd9359c1f4569995d3e', 'artifact': None, 'status': 'success'}, {'content': '成功预定了如家酒店的住宿。如果你还有其他需求，比如了解酒店设施、周边环境或者交通情况等，请随时告诉我。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 31, 'prompt_tokens': 2439, 'total_tokens': 2470, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-e614909d-ce63-9505-9dd8-714eb8b67b58', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--eb99c62d-43e0-4ce9-a4c1-66d1a1b10397-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2439, 'output_tokens': 31, 'total_tokens': 2470, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-09-01 18:01:47,565 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='test01' query='上海天气如何' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-09-01 18:01:49,917 - __main__ - INFO - 当前触发工具调用中断:session_id='59b20abc-7a0e-4b21-8a8a-dae01872246b' status='interrupted' timestamp=1756720909.9172177 message=None result=None interrupt_data={'action_request': {'action': 'maps_weather', 'args': {'city': '上海'}}, 'config': None, 'description': "准备调用 maps_weather 工具：\n- 参数为: {'city': '上海'}\n\n是否允许继续？\n输入 'yes' 接受工具调用\n输入 'no' 拒绝工具调用\n输入 'edit' 修改工具参数后调用工具\n输入 'response' 不调用工具直接反馈信息", 'interrupt_type': 'unknown'}
2025-09-01 18:02:12,928 - __main__ - INFO - get_system_info接口，接受到前端用户请求
2025-09-01 18:02:12,931 - __main__ - INFO - 返回当前系统状态信息:sessions_count=1 active_users=['test01']
2025-09-01 18:02:39,230 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:test01
2025-09-01 18:02:39,233 - __main__ - INFO - 返回当前用户的状态:user_id='test01' session_id='59b20abc-7a0e-4b21-8a8a-dae01872246b' status='interrupted' message=None last_query='上海天气如何' last_updated=1756720909.9187791 last_response=AgentResponse(session_id='59b20abc-7a0e-4b21-8a8a-dae01872246b', status='interrupted', timestamp=1756720909.9172177, message=None, result=None, interrupt_data={'action_request': {'action': 'maps_weather', 'args': {'city': '上海'}}, 'config': None, 'description': "准备调用 maps_weather 工具：\n- 参数为: {'city': '上海'}\n\n是否允许继续？\n输入 'yes' 接受工具调用\n输入 'no' 拒绝工具调用\n输入 'edit' 修改工具参数后调用工具\n输入 'response' 不调用工具直接反馈信息", 'interrupt_type': 'unknown'})
2025-09-01 18:02:52,012 - __main__ - INFO - resume_agent接口，接受到前端用户请求:user_id='test01' session_id='59b20abc-7a0e-4b21-8a8a-dae01872246b' response_type='accept' args=None
2025-09-01 18:02:52,022 - utils.tools - INFO - response: {'type': 'accept'}
2025-09-01 18:02:52,023 - utils.tools - INFO - 工具调用已批准，执行中...
2025-09-01 18:02:52,024 - utils.tools - INFO - 调用工具: maps_weather, 参数: {'city': '上海'}
2025-09-01 18:02:52,977 - utils.tools - INFO - {"city":"上海市","forecasts":[{"date":"2025-09-01","week":"1","dayweather":"中雨","nightweather":"小雨","daytemp":"34","nighttemp":"25","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"34.0","nighttemp_float":"25.0"},{"date":"2025-09-02","week":"2","dayweather":"中雨","nightweather":"小雨","daytemp":"31","nighttemp":"26","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"31.0","nighttemp_float":"26.0"},{"date":"2025-09-03","week":"3","dayweather":"小雨","nightweather":"阴","daytemp":"32","nighttemp":"27","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"32.0","nighttemp_float":"27.0"},{"date":"2025-09-04","week":"4","dayweather":"小雨","nightweather":"阴","daytemp":"33","nighttemp":"27","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"33.0","nighttemp_float":"27.0"}]}
2025-09-01 18:03:03,364 - __main__ - INFO - 最终智能体回复结果:session_id='59b20abc-7a0e-4b21-8a8a-dae01872246b' status='completed' timestamp=1756720983.3640363 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='c470304b-6018-4c13-8de2-47d7c733086d'), HumanMessage(content='你好', additional_kwargs={}, response_metadata={}, id='2031cd23-eef8-4a89-b8d1-2d5201d39546'), AIMessage(content='你好！有什么可以帮助你的吗？', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-9e979114-4fb2-9d51-a686-a943253815c0', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--8aea6a18-ebc5-4145-9be6-9ef6a3cac4dd-0', usage_metadata={'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='ba844127-471a-4448-a1a2-59f650261edd'), HumanMessage(content='调用工具预定如家酒店', additional_kwargs={}, response_metadata={}, id='81f9d1d4-0552-4cf8-8cdb-61986d0fefa7'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_5ebcd9359c1f4569995d3e', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 24, 'prompt_tokens': 2384, 'total_tokens': 2408, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-a15c090f-b700-9708-8816-671b3458cea4', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--34432abf-3158-4926-b968-cbf89367c017-0', tool_calls=[{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_5ebcd9359c1f4569995d3e', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2384, 'output_tokens': 24, 'total_tokens': 2408, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}), ToolMessage(content='成功预定了在如家酒店的住宿。', name='book_hotel', id='6f70b6c7-27f3-4871-9f1b-7ca481e18a6c', tool_call_id='call_5ebcd9359c1f4569995d3e'), AIMessage(content='成功预定了如家酒店的住宿。如果你还有其他需求，比如了解酒店设施、周边环境或者交通情况等，请随时告诉我。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 2439, 'total_tokens': 2470, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-e614909d-ce63-9505-9dd8-714eb8b67b58', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--eb99c62d-43e0-4ce9-a4c1-66d1a1b10397-0', usage_metadata={'input_tokens': 2439, 'output_tokens': 31, 'total_tokens': 2470, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='da8907f4-1db8-42a8-8385-66f12e18cdfa'), HumanMessage(content='上海天气如何', additional_kwargs={}, response_metadata={}, id='35a4a52c-a8c1-4697-b82d-48e080b8ea64'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_a615f71f909f44a5b58708', 'function': {'arguments': '{"city": "上海"}', 'name': 'maps_weather'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 17, 'prompt_tokens': 2499, 'total_tokens': 2516, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-28f0f607-f6f2-9bff-8d74-e3b0a3df310f', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--8ec32454-ec0c-4f2e-baec-5e5853b03bb0-0', tool_calls=[{'name': 'maps_weather', 'args': {'city': '上海'}, 'id': 'call_a615f71f909f44a5b58708', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2499, 'output_tokens': 17, 'total_tokens': 2516, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), ToolMessage(content='{"city":"上海市","forecasts":[{"date":"2025-09-01","week":"1","dayweather":"中雨","nightweather":"小雨","daytemp":"34","nighttemp":"25","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"34.0","nighttemp_float":"25.0"},{"date":"2025-09-02","week":"2","dayweather":"中雨","nightweather":"小雨","daytemp":"31","nighttemp":"26","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"31.0","nighttemp_float":"26.0"},{"date":"2025-09-03","week":"3","dayweather":"小雨","nightweather":"阴","daytemp":"32","nighttemp":"27","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"32.0","nighttemp_float":"27.0"},{"date":"2025-09-04","week":"4","dayweather":"小雨","nightweather":"阴","daytemp":"33","nighttemp":"27","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"33.0","nighttemp_float":"27.0"}]}', name='maps_weather', id='3d7b8ce3-6e2d-4792-be78-059beafa79e0', tool_call_id='call_a615f71f909f44a5b58708'), AIMessage(content='上海市的天气情况如下：\n\n- 2025-09-01（星期一）：白天中雨，夜间小雨，气温34°C/25°C，风向东南，风力1-3级。\n- 2025-09-02（星期二）：白天中雨，夜间小雨，气温31°C/26°C，风向东南，风力1-3级。\n- 2025-09-03（星期三）：白天小雨，夜间阴天，气温32°C/27°C，风向东南，风力1-3级。\n- 2025-09-04（星期四）：白天小雨，夜间阴天，气温33°C/27°C，风向东南，风力1-3级。\n\n请注意携带雨具，并根据天气变化适当调整着装。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 202, 'prompt_tokens': 2871, 'total_tokens': 3073, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-756e2b5a-ba0f-92e6-b04a-422b3105a7c0', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--cdfb0649-c6b7-4402-9b8e-7bc3adba52b1-0', usage_metadata={'input_tokens': 2871, 'output_tokens': 202, 'total_tokens': 3073, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}})]} interrupt_data=None
2025-09-01 18:03:05,403 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:test01
2025-09-01 18:03:05,406 - __main__ - INFO - 返回当前用户的状态:user_id='test01' session_id='59b20abc-7a0e-4b21-8a8a-dae01872246b' status='completed' message=None last_query='上海天气如何' last_updated=1756720983.3659317 last_response=AgentResponse(session_id='59b20abc-7a0e-4b21-8a8a-dae01872246b', status='completed', timestamp=1756720983.3640363, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'c470304b-6018-4c13-8de2-47d7c733086d'}, {'content': '你好', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '2031cd23-eef8-4a89-b8d1-2d5201d39546', 'example': False}, {'content': '你好！有什么可以帮助你的吗？', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-9e979114-4fb2-9d51-a686-a943253815c0', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--8aea6a18-ebc5-4145-9be6-9ef6a3cac4dd-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'ba844127-471a-4448-a1a2-59f650261edd'}, {'content': '调用工具预定如家酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '81f9d1d4-0552-4cf8-8cdb-61986d0fefa7', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_5ebcd9359c1f4569995d3e', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 24, 'prompt_tokens': 2384, 'total_tokens': 2408, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-a15c090f-b700-9708-8816-671b3458cea4', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--34432abf-3158-4926-b968-cbf89367c017-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_5ebcd9359c1f4569995d3e', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2384, 'output_tokens': 24, 'total_tokens': 2408, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '成功预定了在如家酒店的住宿。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': '6f70b6c7-27f3-4871-9f1b-7ca481e18a6c', 'tool_call_id': 'call_5ebcd9359c1f4569995d3e', 'artifact': None, 'status': 'success'}, {'content': '成功预定了如家酒店的住宿。如果你还有其他需求，比如了解酒店设施、周边环境或者交通情况等，请随时告诉我。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 31, 'prompt_tokens': 2439, 'total_tokens': 2470, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-e614909d-ce63-9505-9dd8-714eb8b67b58', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--eb99c62d-43e0-4ce9-a4c1-66d1a1b10397-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2439, 'output_tokens': 31, 'total_tokens': 2470, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'da8907f4-1db8-42a8-8385-66f12e18cdfa'}, {'content': '上海天气如何', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '35a4a52c-a8c1-4697-b82d-48e080b8ea64', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_a615f71f909f44a5b58708', 'function': {'arguments': '{"city": "上海"}', 'name': 'maps_weather'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 17, 'prompt_tokens': 2499, 'total_tokens': 2516, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-28f0f607-f6f2-9bff-8d74-e3b0a3df310f', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--8ec32454-ec0c-4f2e-baec-5e5853b03bb0-0', 'example': False, 'tool_calls': [{'name': 'maps_weather', 'args': {'city': '上海'}, 'id': 'call_a615f71f909f44a5b58708', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2499, 'output_tokens': 17, 'total_tokens': 2516, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '{"city":"上海市","forecasts":[{"date":"2025-09-01","week":"1","dayweather":"中雨","nightweather":"小雨","daytemp":"34","nighttemp":"25","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"34.0","nighttemp_float":"25.0"},{"date":"2025-09-02","week":"2","dayweather":"中雨","nightweather":"小雨","daytemp":"31","nighttemp":"26","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"31.0","nighttemp_float":"26.0"},{"date":"2025-09-03","week":"3","dayweather":"小雨","nightweather":"阴","daytemp":"32","nighttemp":"27","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"32.0","nighttemp_float":"27.0"},{"date":"2025-09-04","week":"4","dayweather":"小雨","nightweather":"阴","daytemp":"33","nighttemp":"27","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"33.0","nighttemp_float":"27.0"}]}', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'maps_weather', 'id': '3d7b8ce3-6e2d-4792-be78-059beafa79e0', 'tool_call_id': 'call_a615f71f909f44a5b58708', 'artifact': None, 'status': 'success'}, {'content': '上海市的天气情况如下：\n\n- 2025-09-01（星期一）：白天中雨，夜间小雨，气温34°C/25°C，风向东南，风力1-3级。\n- 2025-09-02（星期二）：白天中雨，夜间小雨，气温31°C/26°C，风向东南，风力1-3级。\n- 2025-09-03（星期三）：白天小雨，夜间阴天，气温32°C/27°C，风向东南，风力1-3级。\n- 2025-09-04（星期四）：白天小雨，夜间阴天，气温33°C/27°C，风向东南，风力1-3级。\n\n请注意携带雨具，并根据天气变化适当调整着装。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 202, 'prompt_tokens': 2871, 'total_tokens': 3073, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-756e2b5a-ba0f-92e6-b04a-422b3105a7c0', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--cdfb0649-c6b7-4402-9b8e-7bc3adba52b1-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2871, 'output_tokens': 202, 'total_tokens': 3073, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-09-01 18:06:48,066 - __main__ - INFO - 关闭服务并完成资源清理
2025-09-01 21:34:48,374 - __main__ - INFO - Redis初始化成功
2025-09-01 21:34:51,364 - utils.llms - INFO - 成功初始化 qwen LLM
2025-09-01 21:34:51,365 - __main__ - INFO - Chat模型初始化成功
2025-09-01 21:34:51,658 - __main__ - INFO - Checkpointer初始化成功
2025-09-01 21:34:52,614 - __main__ - INFO - Agent初始化成功
2025-09-01 21:34:52,614 - __main__ - INFO - 服务完成初始化并启动服务
2025-09-01 21:35:40,566 - __main__ - INFO - get_system_info接口，接受到前端用户请求
2025-09-01 21:35:40,570 - __main__ - INFO - 返回当前系统状态信息:sessions_count=0 active_users=[]
2025-09-01 21:36:21,985 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:test01
2025-09-01 21:36:21,987 - __main__ - ERROR - 用户 test01 的会话不存在
2025-09-01 21:36:51,253 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='test01' query='你好' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-09-01 21:36:52,703 - __main__ - INFO - 最终智能体回复结果:session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' status='completed' timestamp=1756733812.7039156 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='0e654d45-2b2e-48ea-bef5-96094a174221'), HumanMessage(content='你好', additional_kwargs={}, response_metadata={}, id='8bebe265-b3bb-4571-ba2d-b6eaaa61ce55'), AIMessage(content='你好！有什么可以帮助你的吗？', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-6cd359a6-329e-946a-bb9a-b6a59d3e0f7e', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--cc95c344-e898-4490-a37c-622cf461244f-0', usage_metadata={'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}})]} interrupt_data=None
2025-09-01 21:36:54,742 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:test01
2025-09-01 21:36:54,745 - __main__ - INFO - 返回当前用户的状态:user_id='test01' session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' status='completed' message=None last_query='你好' last_updated=1756733812.7054577 last_response=AgentResponse(session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae', status='completed', timestamp=1756733812.7039156, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': '0e654d45-2b2e-48ea-bef5-96094a174221'}, {'content': '你好', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '8bebe265-b3bb-4571-ba2d-b6eaaa61ce55', 'example': False}, {'content': '你好！有什么可以帮助你的吗？', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-6cd359a6-329e-946a-bb9a-b6a59d3e0f7e', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--cc95c344-e898-4490-a37c-622cf461244f-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-09-01 21:37:56,544 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='test01' query='调用工具预定如家酒店' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-09-01 21:37:58,150 - __main__ - INFO - 当前触发工具调用中断:session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' status='interrupted' timestamp=1756733878.1502507 message=None result=None interrupt_data={'action_request': {'action': 'book_hotel', 'args': {'hotel_name': '如家酒店'}}, 'config': None, 'description': "准备调用 book_hotel 工具：\n- 参数为: {'hotel_name': '如家酒店'}\n\n是否允许继续？\n输入 'yes' 接受工具调用\n输入 'no' 拒绝工具调用\n输入 'edit' 修改工具参数后调用工具\n输入 'response' 不调用工具直接反馈信息", 'interrupt_type': 'unknown'}
2025-09-01 21:38:29,285 - __main__ - INFO - resume_agent接口，接受到前端用户请求:user_id='test01' session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' response_type='accept' args=None
2025-09-01 21:38:29,296 - utils.tools - INFO - response: {'type': 'accept'}
2025-09-01 21:38:29,297 - utils.tools - INFO - 工具调用已批准，执行中...
2025-09-01 21:38:29,297 - utils.tools - INFO - 调用工具: book_hotel, 参数: {'hotel_name': '如家酒店'}
2025-09-01 21:38:29,298 - utils.tools - INFO - 成功预定了在如家酒店的住宿。
2025-09-01 21:38:31,534 - __main__ - INFO - 最终智能体回复结果:session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' status='completed' timestamp=1756733911.5342886 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='0e654d45-2b2e-48ea-bef5-96094a174221'), HumanMessage(content='你好', additional_kwargs={}, response_metadata={}, id='8bebe265-b3bb-4571-ba2d-b6eaaa61ce55'), AIMessage(content='你好！有什么可以帮助你的吗？', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-6cd359a6-329e-946a-bb9a-b6a59d3e0f7e', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--cc95c344-e898-4490-a37c-622cf461244f-0', usage_metadata={'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='f2acf5e1-4589-49e4-bd52-4f45e5c212bf'), HumanMessage(content='调用工具预定如家酒店', additional_kwargs={}, response_metadata={}, id='e2ec001c-c62d-4fa8-b0cd-6ec307327656'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_411a3d47190348a1b87eac', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 21, 'prompt_tokens': 2384, 'total_tokens': 2405, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-e46232a8-c296-9bfd-9751-d376c6b6bf61', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--43e4eec1-12e2-4a19-8b27-a96a04942f3f-0', tool_calls=[{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_411a3d47190348a1b87eac', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2384, 'output_tokens': 21, 'total_tokens': 2405, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}), ToolMessage(content='成功预定了在如家酒店的住宿。', name='book_hotel', id='0d6cd380-df27-43a2-9f63-5fcff9b4c57d', tool_call_id='call_411a3d47190348a1b87eac'), AIMessage(content='成功预定了如家酒店的住宿。如果你需要进一步的帮助，比如了解预定详情、入住时间等信息，请告诉我。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 2439, 'total_tokens': 2467, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-75575751-d0dd-9978-b77e-326cf60f9859', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--875f857e-9466-4632-b64a-b547ea552b3d-0', usage_metadata={'input_tokens': 2439, 'output_tokens': 28, 'total_tokens': 2467, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}})]} interrupt_data=None
2025-09-01 21:38:33,581 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:test01
2025-09-01 21:38:33,584 - __main__ - INFO - 返回当前用户的状态:user_id='test01' session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' status='completed' message=None last_query='调用工具预定如家酒店' last_updated=1756733911.53647 last_response=AgentResponse(session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae', status='completed', timestamp=1756733911.5342886, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': '0e654d45-2b2e-48ea-bef5-96094a174221'}, {'content': '你好', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '8bebe265-b3bb-4571-ba2d-b6eaaa61ce55', 'example': False}, {'content': '你好！有什么可以帮助你的吗？', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-6cd359a6-329e-946a-bb9a-b6a59d3e0f7e', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--cc95c344-e898-4490-a37c-622cf461244f-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'f2acf5e1-4589-49e4-bd52-4f45e5c212bf'}, {'content': '调用工具预定如家酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': 'e2ec001c-c62d-4fa8-b0cd-6ec307327656', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_411a3d47190348a1b87eac', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 21, 'prompt_tokens': 2384, 'total_tokens': 2405, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-e46232a8-c296-9bfd-9751-d376c6b6bf61', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--43e4eec1-12e2-4a19-8b27-a96a04942f3f-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_411a3d47190348a1b87eac', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2384, 'output_tokens': 21, 'total_tokens': 2405, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '成功预定了在如家酒店的住宿。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': '0d6cd380-df27-43a2-9f63-5fcff9b4c57d', 'tool_call_id': 'call_411a3d47190348a1b87eac', 'artifact': None, 'status': 'success'}, {'content': '成功预定了如家酒店的住宿。如果你需要进一步的帮助，比如了解预定详情、入住时间等信息，请告诉我。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 28, 'prompt_tokens': 2439, 'total_tokens': 2467, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-75575751-d0dd-9978-b77e-326cf60f9859', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--875f857e-9466-4632-b64a-b547ea552b3d-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2439, 'output_tokens': 28, 'total_tokens': 2467, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-09-01 21:38:51,126 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='test01' query='调用工具预定桔子酒店' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-09-01 21:38:52,797 - __main__ - INFO - 当前触发工具调用中断:session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' status='interrupted' timestamp=1756733932.797358 message=None result=None interrupt_data={'action_request': {'action': 'book_hotel', 'args': {'hotel_name': '桃子酒店'}}, 'config': None, 'description': "准备调用 book_hotel 工具：\n- 参数为: {'hotel_name': '桃子酒店'}\n\n是否允许继续？\n输入 'yes' 接受工具调用\n输入 'no' 拒绝工具调用\n输入 'edit' 修改工具参数后调用工具\n输入 'response' 不调用工具直接反馈信息", 'interrupt_type': 'unknown'}
2025-09-01 21:38:58,616 - __main__ - INFO - resume_agent接口，接受到前端用户请求:user_id='test01' session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' response_type='reject' args=None
2025-09-01 21:38:58,625 - utils.tools - INFO - response: {'type': 'reject'}
2025-09-01 21:38:58,626 - utils.tools - INFO - 工具调用被拒绝，等待用户输入...
2025-09-01 21:39:01,059 - __main__ - INFO - 最终智能体回复结果:session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' status='completed' timestamp=1756733941.0586374 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='0e654d45-2b2e-48ea-bef5-96094a174221'), HumanMessage(content='你好', additional_kwargs={}, response_metadata={}, id='8bebe265-b3bb-4571-ba2d-b6eaaa61ce55'), AIMessage(content='你好！有什么可以帮助你的吗？', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-6cd359a6-329e-946a-bb9a-b6a59d3e0f7e', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--cc95c344-e898-4490-a37c-622cf461244f-0', usage_metadata={'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='f2acf5e1-4589-49e4-bd52-4f45e5c212bf'), HumanMessage(content='调用工具预定如家酒店', additional_kwargs={}, response_metadata={}, id='e2ec001c-c62d-4fa8-b0cd-6ec307327656'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_411a3d47190348a1b87eac', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 21, 'prompt_tokens': 2384, 'total_tokens': 2405, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-e46232a8-c296-9bfd-9751-d376c6b6bf61', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--43e4eec1-12e2-4a19-8b27-a96a04942f3f-0', tool_calls=[{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_411a3d47190348a1b87eac', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2384, 'output_tokens': 21, 'total_tokens': 2405, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}), ToolMessage(content='成功预定了在如家酒店的住宿。', name='book_hotel', id='0d6cd380-df27-43a2-9f63-5fcff9b4c57d', tool_call_id='call_411a3d47190348a1b87eac'), AIMessage(content='成功预定了如家酒店的住宿。如果你需要进一步的帮助，比如了解预定详情、入住时间等信息，请告诉我。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 2439, 'total_tokens': 2467, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-75575751-d0dd-9978-b77e-326cf60f9859', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--875f857e-9466-4632-b64a-b547ea552b3d-0', usage_metadata={'input_tokens': 2439, 'output_tokens': 28, 'total_tokens': 2467, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='4821d13f-1b32-4a87-94db-012ca29c4412'), HumanMessage(content='调用工具预定桔子酒店', additional_kwargs={}, response_metadata={}, id='7f868356-7503-4dba-b8fe-9b6bd026bb53'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_f1f42e03aec54ed6b77a69', 'function': {'arguments': '{"hotel_name": "\\u6843\\u5b50\\u9152\\u5e97"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 2500, 'total_tokens': 2538, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-88083c94-6c5e-982e-b894-c1ee3580bd58', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--c1bd9eba-765c-4310-89e2-9b3e8c772498-0', tool_calls=[{'name': 'book_hotel', 'args': {'hotel_name': '桃子酒店'}, 'id': 'call_f1f42e03aec54ed6b77a69', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2500, 'output_tokens': 38, 'total_tokens': 2538, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}), ToolMessage(content='该工具被拒绝使用，请尝试其他方法或拒绝回答问题。', name='book_hotel', id='817f8489-df02-4c62-8098-07d9c3a4a2f9', tool_call_id='call_f1f42e03aec54ed6b77a69'), AIMessage(content='对于预定桔子酒店的请求，我这次无法通过工具来完成。你可以尝试直接访问桔子酒店的官方网站或是使用其他在线旅行服务平台进行预订。如果需要进一步的帮助，请随时告诉我。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 2560, 'total_tokens': 2604, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-2a3e2e03-f132-90f4-b46d-5bd19c61f9bc', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--48ca915e-5dd8-4917-837c-dcfc8037c3af-0', usage_metadata={'input_tokens': 2560, 'output_tokens': 44, 'total_tokens': 2604, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}})]} interrupt_data=None
2025-09-01 21:39:03,099 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:test01
2025-09-01 21:39:03,103 - __main__ - INFO - 返回当前用户的状态:user_id='test01' session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' status='completed' message=None last_query='调用工具预定桔子酒店' last_updated=1756733941.0606964 last_response=AgentResponse(session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae', status='completed', timestamp=1756733941.0586374, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': '0e654d45-2b2e-48ea-bef5-96094a174221'}, {'content': '你好', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '8bebe265-b3bb-4571-ba2d-b6eaaa61ce55', 'example': False}, {'content': '你好！有什么可以帮助你的吗？', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-6cd359a6-329e-946a-bb9a-b6a59d3e0f7e', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--cc95c344-e898-4490-a37c-622cf461244f-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'f2acf5e1-4589-49e4-bd52-4f45e5c212bf'}, {'content': '调用工具预定如家酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': 'e2ec001c-c62d-4fa8-b0cd-6ec307327656', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_411a3d47190348a1b87eac', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 21, 'prompt_tokens': 2384, 'total_tokens': 2405, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-e46232a8-c296-9bfd-9751-d376c6b6bf61', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--43e4eec1-12e2-4a19-8b27-a96a04942f3f-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_411a3d47190348a1b87eac', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2384, 'output_tokens': 21, 'total_tokens': 2405, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '成功预定了在如家酒店的住宿。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': '0d6cd380-df27-43a2-9f63-5fcff9b4c57d', 'tool_call_id': 'call_411a3d47190348a1b87eac', 'artifact': None, 'status': 'success'}, {'content': '成功预定了如家酒店的住宿。如果你需要进一步的帮助，比如了解预定详情、入住时间等信息，请告诉我。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 28, 'prompt_tokens': 2439, 'total_tokens': 2467, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-75575751-d0dd-9978-b77e-326cf60f9859', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--875f857e-9466-4632-b64a-b547ea552b3d-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2439, 'output_tokens': 28, 'total_tokens': 2467, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': '4821d13f-1b32-4a87-94db-012ca29c4412'}, {'content': '调用工具预定桔子酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '7f868356-7503-4dba-b8fe-9b6bd026bb53', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_f1f42e03aec54ed6b77a69', 'function': {'arguments': '{"hotel_name": "\\u6843\\u5b50\\u9152\\u5e97"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 38, 'prompt_tokens': 2500, 'total_tokens': 2538, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-88083c94-6c5e-982e-b894-c1ee3580bd58', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--c1bd9eba-765c-4310-89e2-9b3e8c772498-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '桃子酒店'}, 'id': 'call_f1f42e03aec54ed6b77a69', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2500, 'output_tokens': 38, 'total_tokens': 2538, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '该工具被拒绝使用，请尝试其他方法或拒绝回答问题。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': '817f8489-df02-4c62-8098-07d9c3a4a2f9', 'tool_call_id': 'call_f1f42e03aec54ed6b77a69', 'artifact': None, 'status': 'success'}, {'content': '对于预定桔子酒店的请求，我这次无法通过工具来完成。你可以尝试直接访问桔子酒店的官方网站或是使用其他在线旅行服务平台进行预订。如果需要进一步的帮助，请随时告诉我。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 44, 'prompt_tokens': 2560, 'total_tokens': 2604, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-2a3e2e03-f132-90f4-b46d-5bd19c61f9bc', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--48ca915e-5dd8-4917-837c-dcfc8037c3af-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2560, 'output_tokens': 44, 'total_tokens': 2604, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-09-01 21:39:28,413 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='test01' query='调用工具预定全季酒店' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-09-01 21:39:30,918 - __main__ - INFO - 当前触发工具调用中断:session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' status='interrupted' timestamp=1756733970.918139 message=None result=None interrupt_data={'action_request': {'action': 'book_hotel', 'args': {'hotel_name': '全季酒店'}}, 'config': None, 'description': "准备调用 book_hotel 工具：\n- 参数为: {'hotel_name': '全季酒店'}\n\n是否允许继续？\n输入 'yes' 接受工具调用\n输入 'no' 拒绝工具调用\n输入 'edit' 修改工具参数后调用工具\n输入 'response' 不调用工具直接反馈信息", 'interrupt_type': 'unknown'}
2025-09-01 21:39:51,010 - __main__ - INFO - resume_agent接口，接受到前端用户请求:user_id='test01' session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' response_type='edit' args={'args': {'hotel_name': '全季酒店(软件园店)'}}
2025-09-01 21:39:51,018 - utils.tools - INFO - response: {'type': 'edit', 'args': {'args': {'hotel_name': '全季酒店(软件园店)'}}}
2025-09-01 21:39:51,019 - utils.tools - INFO - 成功预定了在全季酒店(软件园店)的住宿。
2025-09-01 21:39:54,203 - __main__ - INFO - 最终智能体回复结果:session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' status='completed' timestamp=1756733994.203021 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='0e654d45-2b2e-48ea-bef5-96094a174221'), HumanMessage(content='你好', additional_kwargs={}, response_metadata={}, id='8bebe265-b3bb-4571-ba2d-b6eaaa61ce55'), AIMessage(content='你好！有什么可以帮助你的吗？', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-6cd359a6-329e-946a-bb9a-b6a59d3e0f7e', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--cc95c344-e898-4490-a37c-622cf461244f-0', usage_metadata={'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='f2acf5e1-4589-49e4-bd52-4f45e5c212bf'), HumanMessage(content='调用工具预定如家酒店', additional_kwargs={}, response_metadata={}, id='e2ec001c-c62d-4fa8-b0cd-6ec307327656'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_411a3d47190348a1b87eac', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 21, 'prompt_tokens': 2384, 'total_tokens': 2405, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-e46232a8-c296-9bfd-9751-d376c6b6bf61', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--43e4eec1-12e2-4a19-8b27-a96a04942f3f-0', tool_calls=[{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_411a3d47190348a1b87eac', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2384, 'output_tokens': 21, 'total_tokens': 2405, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}), ToolMessage(content='成功预定了在如家酒店的住宿。', name='book_hotel', id='0d6cd380-df27-43a2-9f63-5fcff9b4c57d', tool_call_id='call_411a3d47190348a1b87eac'), AIMessage(content='成功预定了如家酒店的住宿。如果你需要进一步的帮助，比如了解预定详情、入住时间等信息，请告诉我。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 2439, 'total_tokens': 2467, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-75575751-d0dd-9978-b77e-326cf60f9859', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--875f857e-9466-4632-b64a-b547ea552b3d-0', usage_metadata={'input_tokens': 2439, 'output_tokens': 28, 'total_tokens': 2467, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='4821d13f-1b32-4a87-94db-012ca29c4412'), HumanMessage(content='调用工具预定桔子酒店', additional_kwargs={}, response_metadata={}, id='7f868356-7503-4dba-b8fe-9b6bd026bb53'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_f1f42e03aec54ed6b77a69', 'function': {'arguments': '{"hotel_name": "\\u6843\\u5b50\\u9152\\u5e97"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 2500, 'total_tokens': 2538, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-88083c94-6c5e-982e-b894-c1ee3580bd58', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--c1bd9eba-765c-4310-89e2-9b3e8c772498-0', tool_calls=[{'name': 'book_hotel', 'args': {'hotel_name': '桃子酒店'}, 'id': 'call_f1f42e03aec54ed6b77a69', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2500, 'output_tokens': 38, 'total_tokens': 2538, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}), ToolMessage(content='该工具被拒绝使用，请尝试其他方法或拒绝回答问题。', name='book_hotel', id='817f8489-df02-4c62-8098-07d9c3a4a2f9', tool_call_id='call_f1f42e03aec54ed6b77a69'), AIMessage(content='对于预定桔子酒店的请求，我这次无法通过工具来完成。你可以尝试直接访问桔子酒店的官方网站或是使用其他在线旅行服务平台进行预订。如果需要进一步的帮助，请随时告诉我。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 2560, 'total_tokens': 2604, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-2a3e2e03-f132-90f4-b46d-5bd19c61f9bc', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--48ca915e-5dd8-4917-837c-dcfc8037c3af-0', usage_metadata={'input_tokens': 2560, 'output_tokens': 44, 'total_tokens': 2604, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='ea1b6088-b5a6-49b9-8445-fa40413ab3fd'), HumanMessage(content='调用工具预定全季酒店', additional_kwargs={}, response_metadata={}, id='7d4828d2-6f23-4f54-9730-50299106506f'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_6000d2699592431c8ade43', 'function': {'arguments': '{"hotel_name": "\\u5168\\u5b63\\u9152\\u5e97"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 2637, 'total_tokens': 2675, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-08a5c3f7-79b7-98bd-bf45-e0c5ea52b1fb', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--d8700dfb-d75f-4de1-a6e0-b6cf5a2eaac6-0', tool_calls=[{'name': 'book_hotel', 'args': {'hotel_name': '全季酒店'}, 'id': 'call_6000d2699592431c8ade43', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2637, 'output_tokens': 38, 'total_tokens': 2675, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}), ToolMessage(content='成功预定了在全季酒店(软件园店)的住宿。', name='book_hotel', id='48b12e83-51b4-4fe1-8367-7669de8b2e0c', tool_call_id='call_6000d2699592431c8ade43'), AIMessage(content='成功预定了全季酒店(软件园店)的住宿。如果你需要更多关于预订的信息，比如入住时间、房间类型等，请随时告知我。如果还有其他需求或问题，也欢迎继续询问。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 47, 'prompt_tokens': 2698, 'total_tokens': 2745, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-56831797-ca74-9a30-8d35-d416c6607a38', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--18a890fe-ff7d-451c-ba7d-4a83f52a7b61-0', usage_metadata={'input_tokens': 2698, 'output_tokens': 47, 'total_tokens': 2745, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}})]} interrupt_data=None
2025-09-01 21:39:56,254 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:test01
2025-09-01 21:39:56,257 - __main__ - INFO - 返回当前用户的状态:user_id='test01' session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' status='completed' message=None last_query='调用工具预定全季酒店' last_updated=1756733994.2051435 last_response=AgentResponse(session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae', status='completed', timestamp=1756733994.203021, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': '0e654d45-2b2e-48ea-bef5-96094a174221'}, {'content': '你好', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '8bebe265-b3bb-4571-ba2d-b6eaaa61ce55', 'example': False}, {'content': '你好！有什么可以帮助你的吗？', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-6cd359a6-329e-946a-bb9a-b6a59d3e0f7e', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--cc95c344-e898-4490-a37c-622cf461244f-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'f2acf5e1-4589-49e4-bd52-4f45e5c212bf'}, {'content': '调用工具预定如家酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': 'e2ec001c-c62d-4fa8-b0cd-6ec307327656', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_411a3d47190348a1b87eac', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 21, 'prompt_tokens': 2384, 'total_tokens': 2405, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-e46232a8-c296-9bfd-9751-d376c6b6bf61', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--43e4eec1-12e2-4a19-8b27-a96a04942f3f-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_411a3d47190348a1b87eac', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2384, 'output_tokens': 21, 'total_tokens': 2405, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '成功预定了在如家酒店的住宿。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': '0d6cd380-df27-43a2-9f63-5fcff9b4c57d', 'tool_call_id': 'call_411a3d47190348a1b87eac', 'artifact': None, 'status': 'success'}, {'content': '成功预定了如家酒店的住宿。如果你需要进一步的帮助，比如了解预定详情、入住时间等信息，请告诉我。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 28, 'prompt_tokens': 2439, 'total_tokens': 2467, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-75575751-d0dd-9978-b77e-326cf60f9859', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--875f857e-9466-4632-b64a-b547ea552b3d-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2439, 'output_tokens': 28, 'total_tokens': 2467, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': '4821d13f-1b32-4a87-94db-012ca29c4412'}, {'content': '调用工具预定桔子酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '7f868356-7503-4dba-b8fe-9b6bd026bb53', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_f1f42e03aec54ed6b77a69', 'function': {'arguments': '{"hotel_name": "\\u6843\\u5b50\\u9152\\u5e97"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 38, 'prompt_tokens': 2500, 'total_tokens': 2538, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-88083c94-6c5e-982e-b894-c1ee3580bd58', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--c1bd9eba-765c-4310-89e2-9b3e8c772498-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '桃子酒店'}, 'id': 'call_f1f42e03aec54ed6b77a69', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2500, 'output_tokens': 38, 'total_tokens': 2538, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '该工具被拒绝使用，请尝试其他方法或拒绝回答问题。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': '817f8489-df02-4c62-8098-07d9c3a4a2f9', 'tool_call_id': 'call_f1f42e03aec54ed6b77a69', 'artifact': None, 'status': 'success'}, {'content': '对于预定桔子酒店的请求，我这次无法通过工具来完成。你可以尝试直接访问桔子酒店的官方网站或是使用其他在线旅行服务平台进行预订。如果需要进一步的帮助，请随时告诉我。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 44, 'prompt_tokens': 2560, 'total_tokens': 2604, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-2a3e2e03-f132-90f4-b46d-5bd19c61f9bc', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--48ca915e-5dd8-4917-837c-dcfc8037c3af-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2560, 'output_tokens': 44, 'total_tokens': 2604, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'ea1b6088-b5a6-49b9-8445-fa40413ab3fd'}, {'content': '调用工具预定全季酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '7d4828d2-6f23-4f54-9730-50299106506f', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_6000d2699592431c8ade43', 'function': {'arguments': '{"hotel_name": "\\u5168\\u5b63\\u9152\\u5e97"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 38, 'prompt_tokens': 2637, 'total_tokens': 2675, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-08a5c3f7-79b7-98bd-bf45-e0c5ea52b1fb', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--d8700dfb-d75f-4de1-a6e0-b6cf5a2eaac6-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '全季酒店'}, 'id': 'call_6000d2699592431c8ade43', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2637, 'output_tokens': 38, 'total_tokens': 2675, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '成功预定了在全季酒店(软件园店)的住宿。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': '48b12e83-51b4-4fe1-8367-7669de8b2e0c', 'tool_call_id': 'call_6000d2699592431c8ade43', 'artifact': None, 'status': 'success'}, {'content': '成功预定了全季酒店(软件园店)的住宿。如果你需要更多关于预订的信息，比如入住时间、房间类型等，请随时告知我。如果还有其他需求或问题，也欢迎继续询问。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 47, 'prompt_tokens': 2698, 'total_tokens': 2745, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-56831797-ca74-9a30-8d35-d416c6607a38', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--18a890fe-ff7d-451c-ba7d-4a83f52a7b61-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2698, 'output_tokens': 47, 'total_tokens': 2745, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-09-01 21:40:15,613 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='test01' query='调用工具预定汉庭酒店' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-09-01 21:40:17,791 - __main__ - INFO - 当前触发工具调用中断:session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' status='interrupted' timestamp=1756734017.7918973 message=None result=None interrupt_data={'action_request': {'action': 'book_hotel', 'args': {'hotel_name': '汉庭酒店'}}, 'config': None, 'description': "准备调用 book_hotel 工具：\n- 参数为: {'hotel_name': '汉庭酒店'}\n\n是否允许继续？\n输入 'yes' 接受工具调用\n输入 'no' 拒绝工具调用\n输入 'edit' 修改工具参数后调用工具\n输入 'response' 不调用工具直接反馈信息", 'interrupt_type': 'unknown'}
2025-09-01 21:40:51,512 - __main__ - INFO - resume_agent接口，接受到前端用户请求:user_id='test01' session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' response_type='response' args={'args': '把酒店名称换为：汉庭酒店(软件园店)，再调用工具预定'}
2025-09-01 21:40:51,523 - utils.tools - INFO - response: {'type': 'response', 'args': {'args': '把酒店名称换为：汉庭酒店(软件园店)，再调用工具预定'}}
2025-09-01 21:40:56,450 - __main__ - INFO - 当前触发工具调用中断:session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' status='interrupted' timestamp=1756734056.4505439 message=None result=None interrupt_data={'action_request': {'action': 'book_hotel', 'args': {'hotel_name': '汉庭酒店(软件园店)'}}, 'config': None, 'description': "准备调用 book_hotel 工具：\n- 参数为: {'hotel_name': '汉庭酒店(软件园店)'}\n\n是否允许继续？\n输入 'yes' 接受工具调用\n输入 'no' 拒绝工具调用\n输入 'edit' 修改工具参数后调用工具\n输入 'response' 不调用工具直接反馈信息", 'interrupt_type': 'unknown'}
2025-09-01 21:41:15,290 - __main__ - INFO - resume_agent接口，接受到前端用户请求:user_id='test01' session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' response_type='accept' args=None
2025-09-01 21:41:15,301 - utils.tools - INFO - response: {'type': 'accept'}
2025-09-01 21:41:15,301 - utils.tools - INFO - 工具调用已批准，执行中...
2025-09-01 21:41:15,302 - utils.tools - INFO - 调用工具: book_hotel, 参数: {'hotel_name': '汉庭酒店(软件园店)'}
2025-09-01 21:41:15,302 - utils.tools - INFO - 成功预定了在汉庭酒店(软件园店)的住宿。
2025-09-01 21:41:18,801 - __main__ - INFO - 最终智能体回复结果:session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' status='completed' timestamp=1756734078.8008404 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='0e654d45-2b2e-48ea-bef5-96094a174221'), HumanMessage(content='你好', additional_kwargs={}, response_metadata={}, id='8bebe265-b3bb-4571-ba2d-b6eaaa61ce55'), AIMessage(content='你好！有什么可以帮助你的吗？', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-6cd359a6-329e-946a-bb9a-b6a59d3e0f7e', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--cc95c344-e898-4490-a37c-622cf461244f-0', usage_metadata={'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='f2acf5e1-4589-49e4-bd52-4f45e5c212bf'), HumanMessage(content='调用工具预定如家酒店', additional_kwargs={}, response_metadata={}, id='e2ec001c-c62d-4fa8-b0cd-6ec307327656'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_411a3d47190348a1b87eac', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 21, 'prompt_tokens': 2384, 'total_tokens': 2405, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-e46232a8-c296-9bfd-9751-d376c6b6bf61', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--43e4eec1-12e2-4a19-8b27-a96a04942f3f-0', tool_calls=[{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_411a3d47190348a1b87eac', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2384, 'output_tokens': 21, 'total_tokens': 2405, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}), ToolMessage(content='成功预定了在如家酒店的住宿。', name='book_hotel', id='0d6cd380-df27-43a2-9f63-5fcff9b4c57d', tool_call_id='call_411a3d47190348a1b87eac'), AIMessage(content='成功预定了如家酒店的住宿。如果你需要进一步的帮助，比如了解预定详情、入住时间等信息，请告诉我。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 2439, 'total_tokens': 2467, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-75575751-d0dd-9978-b77e-326cf60f9859', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--875f857e-9466-4632-b64a-b547ea552b3d-0', usage_metadata={'input_tokens': 2439, 'output_tokens': 28, 'total_tokens': 2467, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='4821d13f-1b32-4a87-94db-012ca29c4412'), HumanMessage(content='调用工具预定桔子酒店', additional_kwargs={}, response_metadata={}, id='7f868356-7503-4dba-b8fe-9b6bd026bb53'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_f1f42e03aec54ed6b77a69', 'function': {'arguments': '{"hotel_name": "\\u6843\\u5b50\\u9152\\u5e97"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 2500, 'total_tokens': 2538, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-88083c94-6c5e-982e-b894-c1ee3580bd58', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--c1bd9eba-765c-4310-89e2-9b3e8c772498-0', tool_calls=[{'name': 'book_hotel', 'args': {'hotel_name': '桃子酒店'}, 'id': 'call_f1f42e03aec54ed6b77a69', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2500, 'output_tokens': 38, 'total_tokens': 2538, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}), ToolMessage(content='该工具被拒绝使用，请尝试其他方法或拒绝回答问题。', name='book_hotel', id='817f8489-df02-4c62-8098-07d9c3a4a2f9', tool_call_id='call_f1f42e03aec54ed6b77a69'), AIMessage(content='对于预定桔子酒店的请求，我这次无法通过工具来完成。你可以尝试直接访问桔子酒店的官方网站或是使用其他在线旅行服务平台进行预订。如果需要进一步的帮助，请随时告诉我。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 2560, 'total_tokens': 2604, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-2a3e2e03-f132-90f4-b46d-5bd19c61f9bc', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--48ca915e-5dd8-4917-837c-dcfc8037c3af-0', usage_metadata={'input_tokens': 2560, 'output_tokens': 44, 'total_tokens': 2604, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='ea1b6088-b5a6-49b9-8445-fa40413ab3fd'), HumanMessage(content='调用工具预定全季酒店', additional_kwargs={}, response_metadata={}, id='7d4828d2-6f23-4f54-9730-50299106506f'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_6000d2699592431c8ade43', 'function': {'arguments': '{"hotel_name": "\\u5168\\u5b63\\u9152\\u5e97"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 2637, 'total_tokens': 2675, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-08a5c3f7-79b7-98bd-bf45-e0c5ea52b1fb', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--d8700dfb-d75f-4de1-a6e0-b6cf5a2eaac6-0', tool_calls=[{'name': 'book_hotel', 'args': {'hotel_name': '全季酒店'}, 'id': 'call_6000d2699592431c8ade43', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2637, 'output_tokens': 38, 'total_tokens': 2675, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}), ToolMessage(content='成功预定了在全季酒店(软件园店)的住宿。', name='book_hotel', id='48b12e83-51b4-4fe1-8367-7669de8b2e0c', tool_call_id='call_6000d2699592431c8ade43'), AIMessage(content='成功预定了全季酒店(软件园店)的住宿。如果你需要更多关于预订的信息，比如入住时间、房间类型等，请随时告知我。如果还有其他需求或问题，也欢迎继续询问。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 47, 'prompt_tokens': 2698, 'total_tokens': 2745, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-56831797-ca74-9a30-8d35-d416c6607a38', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--18a890fe-ff7d-451c-ba7d-4a83f52a7b61-0', usage_metadata={'input_tokens': 2698, 'output_tokens': 47, 'total_tokens': 2745, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='c5c5d404-f30e-42ab-bdbf-b99be40f4108'), HumanMessage(content='调用工具预定汉庭酒店', additional_kwargs={}, response_metadata={}, id='71b597ff-fc84-4d54-9e7c-830b8275f953'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_8dae8340999d46a7a43ed4', 'function': {'arguments': '{"hotel_name": "\\u6c49\\u5ead\\u9152\\u5e97"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 2778, 'total_tokens': 2814, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-3cf2ccbd-aed3-92b2-b619-b9723e74fc4f', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--6d812724-fc8b-44ff-9662-d254a244b040-0', tool_calls=[{'name': 'book_hotel', 'args': {'hotel_name': '汉庭酒店'}, 'id': 'call_8dae8340999d46a7a43ed4', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2778, 'output_tokens': 36, 'total_tokens': 2814, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), ToolMessage(content='{"args": "把酒店名称换为：汉庭酒店(软件园店)，再调用工具预定"}', name='book_hotel', id='cd80a268-b5ae-40f8-b18d-49c11a9bbaf7', tool_call_id='call_8dae8340999d46a7a43ed4'), AIMessage(content='在尝试预定汉庭酒店时，我收到指示需要将酒店名称更改为“汉庭酒店(软件园店)”后再次进行预订。现在，我将按照这个指示来进行操作。', additional_kwargs={'tool_calls': [{'id': 'call_da99043e49ca4b55b02453', 'function': {'arguments': '{"hotel_name": "\\u6c49\\u5ead\\u9152\\u5e97(\\u8f6f\\u4ef6\\u56ed\\u5e97)"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 101, 'prompt_tokens': 2845, 'total_tokens': 2946, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-bebcafb2-1565-9c8d-8642-f7fac7b18937', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--2beb6c15-7cee-4af2-8128-76f2399c6293-0', tool_calls=[{'name': 'book_hotel', 'args': {'hotel_name': '汉庭酒店(软件园店)'}, 'id': 'call_da99043e49ca4b55b02453', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2845, 'output_tokens': 101, 'total_tokens': 2946, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}), ToolMessage(content='成功预定了在汉庭酒店(软件园店)的住宿。', name='book_hotel', id='cf4e17b4-dbbc-4de9-a5a1-99a04818c71f', tool_call_id='call_da99043e49ca4b55b02453'), AIMessage(content='成功预定了汉庭酒店(软件园店)的住宿。如果你需要更多关于预订的信息，比如入住时间、房间类型等，请随时告诉我。如果有其他需求或问题，也欢迎继续询问。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 45, 'prompt_tokens': 2966, 'total_tokens': 3011, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-a514c2e4-5474-9ab4-a030-0ce3b9d418fc', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--52d1d70a-a824-443a-97e6-b0f5df156116-0', usage_metadata={'input_tokens': 2966, 'output_tokens': 45, 'total_tokens': 3011, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}})]} interrupt_data=None
2025-09-01 21:41:20,847 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:test01
2025-09-01 21:41:20,852 - __main__ - INFO - 返回当前用户的状态:user_id='test01' session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' status='completed' message=None last_query='调用工具预定汉庭酒店' last_updated=1756734078.803607 last_response=AgentResponse(session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae', status='completed', timestamp=1756734078.8008404, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': '0e654d45-2b2e-48ea-bef5-96094a174221'}, {'content': '你好', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '8bebe265-b3bb-4571-ba2d-b6eaaa61ce55', 'example': False}, {'content': '你好！有什么可以帮助你的吗？', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-6cd359a6-329e-946a-bb9a-b6a59d3e0f7e', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--cc95c344-e898-4490-a37c-622cf461244f-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'f2acf5e1-4589-49e4-bd52-4f45e5c212bf'}, {'content': '调用工具预定如家酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': 'e2ec001c-c62d-4fa8-b0cd-6ec307327656', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_411a3d47190348a1b87eac', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 21, 'prompt_tokens': 2384, 'total_tokens': 2405, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-e46232a8-c296-9bfd-9751-d376c6b6bf61', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--43e4eec1-12e2-4a19-8b27-a96a04942f3f-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_411a3d47190348a1b87eac', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2384, 'output_tokens': 21, 'total_tokens': 2405, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '成功预定了在如家酒店的住宿。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': '0d6cd380-df27-43a2-9f63-5fcff9b4c57d', 'tool_call_id': 'call_411a3d47190348a1b87eac', 'artifact': None, 'status': 'success'}, {'content': '成功预定了如家酒店的住宿。如果你需要进一步的帮助，比如了解预定详情、入住时间等信息，请告诉我。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 28, 'prompt_tokens': 2439, 'total_tokens': 2467, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-75575751-d0dd-9978-b77e-326cf60f9859', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--875f857e-9466-4632-b64a-b547ea552b3d-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2439, 'output_tokens': 28, 'total_tokens': 2467, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': '4821d13f-1b32-4a87-94db-012ca29c4412'}, {'content': '调用工具预定桔子酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '7f868356-7503-4dba-b8fe-9b6bd026bb53', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_f1f42e03aec54ed6b77a69', 'function': {'arguments': '{"hotel_name": "\\u6843\\u5b50\\u9152\\u5e97"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 38, 'prompt_tokens': 2500, 'total_tokens': 2538, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-88083c94-6c5e-982e-b894-c1ee3580bd58', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--c1bd9eba-765c-4310-89e2-9b3e8c772498-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '桃子酒店'}, 'id': 'call_f1f42e03aec54ed6b77a69', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2500, 'output_tokens': 38, 'total_tokens': 2538, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '该工具被拒绝使用，请尝试其他方法或拒绝回答问题。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': '817f8489-df02-4c62-8098-07d9c3a4a2f9', 'tool_call_id': 'call_f1f42e03aec54ed6b77a69', 'artifact': None, 'status': 'success'}, {'content': '对于预定桔子酒店的请求，我这次无法通过工具来完成。你可以尝试直接访问桔子酒店的官方网站或是使用其他在线旅行服务平台进行预订。如果需要进一步的帮助，请随时告诉我。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 44, 'prompt_tokens': 2560, 'total_tokens': 2604, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-2a3e2e03-f132-90f4-b46d-5bd19c61f9bc', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--48ca915e-5dd8-4917-837c-dcfc8037c3af-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2560, 'output_tokens': 44, 'total_tokens': 2604, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'ea1b6088-b5a6-49b9-8445-fa40413ab3fd'}, {'content': '调用工具预定全季酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '7d4828d2-6f23-4f54-9730-50299106506f', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_6000d2699592431c8ade43', 'function': {'arguments': '{"hotel_name": "\\u5168\\u5b63\\u9152\\u5e97"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 38, 'prompt_tokens': 2637, 'total_tokens': 2675, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-08a5c3f7-79b7-98bd-bf45-e0c5ea52b1fb', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--d8700dfb-d75f-4de1-a6e0-b6cf5a2eaac6-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '全季酒店'}, 'id': 'call_6000d2699592431c8ade43', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2637, 'output_tokens': 38, 'total_tokens': 2675, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '成功预定了在全季酒店(软件园店)的住宿。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': '48b12e83-51b4-4fe1-8367-7669de8b2e0c', 'tool_call_id': 'call_6000d2699592431c8ade43', 'artifact': None, 'status': 'success'}, {'content': '成功预定了全季酒店(软件园店)的住宿。如果你需要更多关于预订的信息，比如入住时间、房间类型等，请随时告知我。如果还有其他需求或问题，也欢迎继续询问。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 47, 'prompt_tokens': 2698, 'total_tokens': 2745, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-56831797-ca74-9a30-8d35-d416c6607a38', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--18a890fe-ff7d-451c-ba7d-4a83f52a7b61-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2698, 'output_tokens': 47, 'total_tokens': 2745, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'c5c5d404-f30e-42ab-bdbf-b99be40f4108'}, {'content': '调用工具预定汉庭酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '71b597ff-fc84-4d54-9e7c-830b8275f953', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_8dae8340999d46a7a43ed4', 'function': {'arguments': '{"hotel_name": "\\u6c49\\u5ead\\u9152\\u5e97"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 36, 'prompt_tokens': 2778, 'total_tokens': 2814, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-3cf2ccbd-aed3-92b2-b619-b9723e74fc4f', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--6d812724-fc8b-44ff-9662-d254a244b040-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '汉庭酒店'}, 'id': 'call_8dae8340999d46a7a43ed4', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2778, 'output_tokens': 36, 'total_tokens': 2814, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '{"args": "把酒店名称换为：汉庭酒店(软件园店)，再调用工具预定"}', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': 'cd80a268-b5ae-40f8-b18d-49c11a9bbaf7', 'tool_call_id': 'call_8dae8340999d46a7a43ed4', 'artifact': None, 'status': 'success'}, {'content': '在尝试预定汉庭酒店时，我收到指示需要将酒店名称更改为“汉庭酒店(软件园店)”后再次进行预订。现在，我将按照这个指示来进行操作。', 'additional_kwargs': {'tool_calls': [{'id': 'call_da99043e49ca4b55b02453', 'function': {'arguments': '{"hotel_name": "\\u6c49\\u5ead\\u9152\\u5e97(\\u8f6f\\u4ef6\\u56ed\\u5e97)"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 101, 'prompt_tokens': 2845, 'total_tokens': 2946, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-bebcafb2-1565-9c8d-8642-f7fac7b18937', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--2beb6c15-7cee-4af2-8128-76f2399c6293-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '汉庭酒店(软件园店)'}, 'id': 'call_da99043e49ca4b55b02453', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2845, 'output_tokens': 101, 'total_tokens': 2946, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '成功预定了在汉庭酒店(软件园店)的住宿。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': 'cf4e17b4-dbbc-4de9-a5a1-99a04818c71f', 'tool_call_id': 'call_da99043e49ca4b55b02453', 'artifact': None, 'status': 'success'}, {'content': '成功预定了汉庭酒店(软件园店)的住宿。如果你需要更多关于预订的信息，比如入住时间、房间类型等，请随时告诉我。如果有其他需求或问题，也欢迎继续询问。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 45, 'prompt_tokens': 2966, 'total_tokens': 3011, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-a514c2e4-5474-9ab4-a030-0ce3b9d418fc', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--52d1d70a-a824-443a-97e6-b0f5df156116-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2966, 'output_tokens': 45, 'total_tokens': 3011, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-09-01 21:42:28,436 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:test01
2025-09-01 21:42:28,441 - __main__ - INFO - 返回当前用户的状态:user_id='test01' session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae' status='completed' message=None last_query='调用工具预定汉庭酒店' last_updated=1756734078.803607 last_response=AgentResponse(session_id='1095db8e-0701-4995-8c4c-ab82abc4bfae', status='completed', timestamp=1756734078.8008404, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': '0e654d45-2b2e-48ea-bef5-96094a174221'}, {'content': '你好', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '8bebe265-b3bb-4571-ba2d-b6eaaa61ce55', 'example': False}, {'content': '你好！有什么可以帮助你的吗？', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 7, 'prompt_tokens': 2344, 'total_tokens': 2351, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-6cd359a6-329e-946a-bb9a-b6a59d3e0f7e', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--cc95c344-e898-4490-a37c-622cf461244f-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2344, 'output_tokens': 7, 'total_tokens': 2351, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'f2acf5e1-4589-49e4-bd52-4f45e5c212bf'}, {'content': '调用工具预定如家酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': 'e2ec001c-c62d-4fa8-b0cd-6ec307327656', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_411a3d47190348a1b87eac', 'function': {'arguments': '{"hotel_name": "如家酒店"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 21, 'prompt_tokens': 2384, 'total_tokens': 2405, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-e46232a8-c296-9bfd-9751-d376c6b6bf61', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--43e4eec1-12e2-4a19-8b27-a96a04942f3f-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '如家酒店'}, 'id': 'call_411a3d47190348a1b87eac', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2384, 'output_tokens': 21, 'total_tokens': 2405, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '成功预定了在如家酒店的住宿。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': '0d6cd380-df27-43a2-9f63-5fcff9b4c57d', 'tool_call_id': 'call_411a3d47190348a1b87eac', 'artifact': None, 'status': 'success'}, {'content': '成功预定了如家酒店的住宿。如果你需要进一步的帮助，比如了解预定详情、入住时间等信息，请告诉我。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 28, 'prompt_tokens': 2439, 'total_tokens': 2467, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-75575751-d0dd-9978-b77e-326cf60f9859', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--875f857e-9466-4632-b64a-b547ea552b3d-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2439, 'output_tokens': 28, 'total_tokens': 2467, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': '4821d13f-1b32-4a87-94db-012ca29c4412'}, {'content': '调用工具预定桔子酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '7f868356-7503-4dba-b8fe-9b6bd026bb53', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_f1f42e03aec54ed6b77a69', 'function': {'arguments': '{"hotel_name": "\\u6843\\u5b50\\u9152\\u5e97"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 38, 'prompt_tokens': 2500, 'total_tokens': 2538, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-88083c94-6c5e-982e-b894-c1ee3580bd58', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--c1bd9eba-765c-4310-89e2-9b3e8c772498-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '桃子酒店'}, 'id': 'call_f1f42e03aec54ed6b77a69', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2500, 'output_tokens': 38, 'total_tokens': 2538, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '该工具被拒绝使用，请尝试其他方法或拒绝回答问题。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': '817f8489-df02-4c62-8098-07d9c3a4a2f9', 'tool_call_id': 'call_f1f42e03aec54ed6b77a69', 'artifact': None, 'status': 'success'}, {'content': '对于预定桔子酒店的请求，我这次无法通过工具来完成。你可以尝试直接访问桔子酒店的官方网站或是使用其他在线旅行服务平台进行预订。如果需要进一步的帮助，请随时告诉我。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 44, 'prompt_tokens': 2560, 'total_tokens': 2604, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-2a3e2e03-f132-90f4-b46d-5bd19c61f9bc', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--48ca915e-5dd8-4917-837c-dcfc8037c3af-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2560, 'output_tokens': 44, 'total_tokens': 2604, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'ea1b6088-b5a6-49b9-8445-fa40413ab3fd'}, {'content': '调用工具预定全季酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '7d4828d2-6f23-4f54-9730-50299106506f', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_6000d2699592431c8ade43', 'function': {'arguments': '{"hotel_name": "\\u5168\\u5b63\\u9152\\u5e97"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 38, 'prompt_tokens': 2637, 'total_tokens': 2675, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-08a5c3f7-79b7-98bd-bf45-e0c5ea52b1fb', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--d8700dfb-d75f-4de1-a6e0-b6cf5a2eaac6-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '全季酒店'}, 'id': 'call_6000d2699592431c8ade43', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2637, 'output_tokens': 38, 'total_tokens': 2675, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '成功预定了在全季酒店(软件园店)的住宿。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': '48b12e83-51b4-4fe1-8367-7669de8b2e0c', 'tool_call_id': 'call_6000d2699592431c8ade43', 'artifact': None, 'status': 'success'}, {'content': '成功预定了全季酒店(软件园店)的住宿。如果你需要更多关于预订的信息，比如入住时间、房间类型等，请随时告知我。如果还有其他需求或问题，也欢迎继续询问。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 47, 'prompt_tokens': 2698, 'total_tokens': 2745, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-56831797-ca74-9a30-8d35-d416c6607a38', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--18a890fe-ff7d-451c-ba7d-4a83f52a7b61-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2698, 'output_tokens': 47, 'total_tokens': 2745, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': 'c5c5d404-f30e-42ab-bdbf-b99be40f4108'}, {'content': '调用工具预定汉庭酒店', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '71b597ff-fc84-4d54-9e7c-830b8275f953', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_8dae8340999d46a7a43ed4', 'function': {'arguments': '{"hotel_name": "\\u6c49\\u5ead\\u9152\\u5e97"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 36, 'prompt_tokens': 2778, 'total_tokens': 2814, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-3cf2ccbd-aed3-92b2-b619-b9723e74fc4f', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--6d812724-fc8b-44ff-9662-d254a244b040-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '汉庭酒店'}, 'id': 'call_8dae8340999d46a7a43ed4', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2778, 'output_tokens': 36, 'total_tokens': 2814, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '{"args": "把酒店名称换为：汉庭酒店(软件园店)，再调用工具预定"}', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': 'cd80a268-b5ae-40f8-b18d-49c11a9bbaf7', 'tool_call_id': 'call_8dae8340999d46a7a43ed4', 'artifact': None, 'status': 'success'}, {'content': '在尝试预定汉庭酒店时，我收到指示需要将酒店名称更改为“汉庭酒店(软件园店)”后再次进行预订。现在，我将按照这个指示来进行操作。', 'additional_kwargs': {'tool_calls': [{'id': 'call_da99043e49ca4b55b02453', 'function': {'arguments': '{"hotel_name": "\\u6c49\\u5ead\\u9152\\u5e97(\\u8f6f\\u4ef6\\u56ed\\u5e97)"}', 'name': 'book_hotel'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 101, 'prompt_tokens': 2845, 'total_tokens': 2946, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-bebcafb2-1565-9c8d-8642-f7fac7b18937', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--2beb6c15-7cee-4af2-8128-76f2399c6293-0', 'example': False, 'tool_calls': [{'name': 'book_hotel', 'args': {'hotel_name': '汉庭酒店(软件园店)'}, 'id': 'call_da99043e49ca4b55b02453', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2845, 'output_tokens': 101, 'total_tokens': 2946, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '成功预定了在汉庭酒店(软件园店)的住宿。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'book_hotel', 'id': 'cf4e17b4-dbbc-4de9-a5a1-99a04818c71f', 'tool_call_id': 'call_da99043e49ca4b55b02453', 'artifact': None, 'status': 'success'}, {'content': '成功预定了汉庭酒店(软件园店)的住宿。如果你需要更多关于预订的信息，比如入住时间、房间类型等，请随时告诉我。如果有其他需求或问题，也欢迎继续询问。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 45, 'prompt_tokens': 2966, 'total_tokens': 3011, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-a514c2e4-5474-9ab4-a030-0ce3b9d418fc', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--52d1d70a-a824-443a-97e6-b0f5df156116-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2966, 'output_tokens': 45, 'total_tokens': 3011, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-09-01 21:43:11,327 - __main__ - INFO - delete_agent_session接口，接受到前端用户请求:test01
2025-09-01 21:43:11,330 - __main__ - INFO - 用户会话已经删除:{'status': 'success', 'message': '用户 test01 的会话已删除'}
2025-09-01 21:43:28,012 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:test01
2025-09-01 21:43:28,014 - __main__ - ERROR - 用户 test01 的会话不存在
2025-09-01 21:44:39,989 - __main__ - INFO - get_system_info接口，接受到前端用户请求
2025-09-01 21:44:39,993 - __main__ - INFO - 返回当前系统状态信息:sessions_count=0 active_users=[]
2025-09-01 21:45:00,883 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:上海天气如何
2025-09-01 21:45:00,885 - __main__ - ERROR - 用户 上海天气如何 的会话不存在
2025-09-01 21:45:10,767 - __main__ - INFO - delete_agent_session接口，接受到前端用户请求:上海天气如何
2025-09-01 21:45:10,770 - __main__ - ERROR - status_code=404,用户 上海天气如何 的会话不存在
2025-09-01 21:45:26,081 - __main__ - INFO - get_system_info接口，接受到前端用户请求
2025-09-01 21:45:26,085 - __main__ - INFO - 返回当前系统状态信息:sessions_count=0 active_users=[]
2025-09-01 21:45:35,533 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:user_1756734326
2025-09-01 21:45:35,535 - __main__ - ERROR - 用户 user_1756734326 的会话不存在
2025-09-01 21:45:47,128 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='user_1756734326' query='上海的天气如何' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-09-01 21:45:48,808 - __main__ - INFO - 当前触发工具调用中断:session_id='0f246a61-7077-4775-8220-e4f32107a250' status='interrupted' timestamp=1756734348.8087428 message=None result=None interrupt_data={'action_request': {'action': 'maps_weather', 'args': {'city': '上海'}}, 'config': None, 'description': "准备调用 maps_weather 工具：\n- 参数为: {'city': '上海'}\n\n是否允许继续？\n输入 'yes' 接受工具调用\n输入 'no' 拒绝工具调用\n输入 'edit' 修改工具参数后调用工具\n输入 'response' 不调用工具直接反馈信息", 'interrupt_type': 'unknown'}
2025-09-01 21:46:24,753 - __main__ - INFO - get_system_info接口，接受到前端用户请求
2025-09-01 21:46:24,757 - __main__ - INFO - 返回当前系统状态信息:sessions_count=1 active_users=['user_1756734326']
2025-09-01 21:47:00,808 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:user_1756734326
2025-09-01 21:47:00,811 - __main__ - INFO - 返回当前用户的状态:user_id='user_1756734326' session_id='0f246a61-7077-4775-8220-e4f32107a250' status='interrupted' message=None last_query='上海的天气如何' last_updated=1756734348.8102934 last_response=AgentResponse(session_id='0f246a61-7077-4775-8220-e4f32107a250', status='interrupted', timestamp=1756734348.8087428, message=None, result=None, interrupt_data={'action_request': {'action': 'maps_weather', 'args': {'city': '上海'}}, 'config': None, 'description': "准备调用 maps_weather 工具：\n- 参数为: {'city': '上海'}\n\n是否允许继续？\n输入 'yes' 接受工具调用\n输入 'no' 拒绝工具调用\n输入 'edit' 修改工具参数后调用工具\n输入 'response' 不调用工具直接反馈信息", 'interrupt_type': 'unknown'})
2025-09-01 21:47:39,716 - __main__ - INFO - resume_agent接口，接受到前端用户请求:user_id='user_1756734326' session_id='0f246a61-7077-4775-8220-e4f32107a250' response_type='accept' args=None
2025-09-01 21:47:39,724 - utils.tools - INFO - response: {'type': 'accept'}
2025-09-01 21:47:39,725 - utils.tools - INFO - 工具调用已批准，执行中...
2025-09-01 21:47:39,726 - utils.tools - INFO - 调用工具: maps_weather, 参数: {'city': '上海'}
2025-09-01 21:47:40,777 - utils.tools - INFO - {"city":"上海市","forecasts":[{"date":"2025-09-01","week":"1","dayweather":"中雨","nightweather":"小雨","daytemp":"34","nighttemp":"26","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"34.0","nighttemp_float":"26.0"},{"date":"2025-09-02","week":"2","dayweather":"中雨","nightweather":"小雨","daytemp":"31","nighttemp":"26","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"31.0","nighttemp_float":"26.0"},{"date":"2025-09-03","week":"3","dayweather":"小雨","nightweather":"阴","daytemp":"32","nighttemp":"27","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"32.0","nighttemp_float":"27.0"},{"date":"2025-09-04","week":"4","dayweather":"小雨","nightweather":"阴","daytemp":"34","nighttemp":"27","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"34.0","nighttemp_float":"27.0"}]}
2025-09-01 21:47:50,674 - __main__ - INFO - 最终智能体回复结果:session_id='0f246a61-7077-4775-8220-e4f32107a250' status='completed' timestamp=1756734470.6743815 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='2ada5601-81f4-40f9-bb65-5ce265693b29'), HumanMessage(content='上海的天气如何', additional_kwargs={}, response_metadata={}, id='649b73b8-730f-4535-ad1c-dfceb343698a'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_57696a2083504641bcbe19', 'function': {'arguments': '{"city": "上海"}', 'name': 'maps_weather'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 17, 'prompt_tokens': 2347, 'total_tokens': 2364, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-c7d9c880-59d8-96ae-9e58-e52c812ab10b', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--474fe3dd-e83e-42d4-bb70-c1afb75c9552-0', tool_calls=[{'name': 'maps_weather', 'args': {'city': '上海'}, 'id': 'call_57696a2083504641bcbe19', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2347, 'output_tokens': 17, 'total_tokens': 2364, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), ToolMessage(content='{"city":"上海市","forecasts":[{"date":"2025-09-01","week":"1","dayweather":"中雨","nightweather":"小雨","daytemp":"34","nighttemp":"26","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"34.0","nighttemp_float":"26.0"},{"date":"2025-09-02","week":"2","dayweather":"中雨","nightweather":"小雨","daytemp":"31","nighttemp":"26","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"31.0","nighttemp_float":"26.0"},{"date":"2025-09-03","week":"3","dayweather":"小雨","nightweather":"阴","daytemp":"32","nighttemp":"27","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"32.0","nighttemp_float":"27.0"},{"date":"2025-09-04","week":"4","dayweather":"小雨","nightweather":"阴","daytemp":"34","nighttemp":"27","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"34.0","nighttemp_float":"27.0"}]}', name='maps_weather', id='0affb660-3224-4a62-90ff-abb1004ef0e4', tool_call_id='call_57696a2083504641bcbe19'), AIMessage(content='上海市的天气预报如下：\n\n- 2025-09-01 (星期一)：白天中雨，夜晚小雨，气温34°C/26°C，东南风，风力等级1-3级。\n- 2025-09-02 (星期二)：白天中雨，夜晚小雨，气温31°C/26°C，东南风，风力等级1-3级。\n- 2025-09-03 (星期三)：白天小雨，夜晚阴天，气温32°C/27°C，东南风，风力等级1-3级。\n- 2025-09-04 (星期四)：白天小雨，夜晚阴天，气温34°C/27°C，东南风，风力等级1-3级。\n\n请注意携带雨具，并根据天气变化适时调整着装。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 202, 'prompt_tokens': 2719, 'total_tokens': 2921, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-0a5ef83b-3817-93cd-85d2-d52e68ade44c', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--1cacbc54-4977-40a3-b57e-0df8cb3e7d5d-0', usage_metadata={'input_tokens': 2719, 'output_tokens': 202, 'total_tokens': 2921, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}})]} interrupt_data=None
2025-09-01 21:47:52,722 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:user_1756734326
2025-09-01 21:47:52,725 - __main__ - INFO - 返回当前用户的状态:user_id='user_1756734326' session_id='0f246a61-7077-4775-8220-e4f32107a250' status='completed' message=None last_query='上海的天气如何' last_updated=1756734470.6759377 last_response=AgentResponse(session_id='0f246a61-7077-4775-8220-e4f32107a250', status='completed', timestamp=1756734470.6743815, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': '2ada5601-81f4-40f9-bb65-5ce265693b29'}, {'content': '上海的天气如何', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '649b73b8-730f-4535-ad1c-dfceb343698a', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_57696a2083504641bcbe19', 'function': {'arguments': '{"city": "上海"}', 'name': 'maps_weather'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 17, 'prompt_tokens': 2347, 'total_tokens': 2364, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-c7d9c880-59d8-96ae-9e58-e52c812ab10b', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--474fe3dd-e83e-42d4-bb70-c1afb75c9552-0', 'example': False, 'tool_calls': [{'name': 'maps_weather', 'args': {'city': '上海'}, 'id': 'call_57696a2083504641bcbe19', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2347, 'output_tokens': 17, 'total_tokens': 2364, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '{"city":"上海市","forecasts":[{"date":"2025-09-01","week":"1","dayweather":"中雨","nightweather":"小雨","daytemp":"34","nighttemp":"26","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"34.0","nighttemp_float":"26.0"},{"date":"2025-09-02","week":"2","dayweather":"中雨","nightweather":"小雨","daytemp":"31","nighttemp":"26","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"31.0","nighttemp_float":"26.0"},{"date":"2025-09-03","week":"3","dayweather":"小雨","nightweather":"阴","daytemp":"32","nighttemp":"27","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"32.0","nighttemp_float":"27.0"},{"date":"2025-09-04","week":"4","dayweather":"小雨","nightweather":"阴","daytemp":"34","nighttemp":"27","daywind":"东南","nightwind":"东南","daypower":"1-3","nightpower":"1-3","daytemp_float":"34.0","nighttemp_float":"27.0"}]}', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'maps_weather', 'id': '0affb660-3224-4a62-90ff-abb1004ef0e4', 'tool_call_id': 'call_57696a2083504641bcbe19', 'artifact': None, 'status': 'success'}, {'content': '上海市的天气预报如下：\n\n- 2025-09-01 (星期一)：白天中雨，夜晚小雨，气温34°C/26°C，东南风，风力等级1-3级。\n- 2025-09-02 (星期二)：白天中雨，夜晚小雨，气温31°C/26°C，东南风，风力等级1-3级。\n- 2025-09-03 (星期三)：白天小雨，夜晚阴天，气温32°C/27°C，东南风，风力等级1-3级。\n- 2025-09-04 (星期四)：白天小雨，夜晚阴天，气温34°C/27°C，东南风，风力等级1-3级。\n\n请注意携带雨具，并根据天气变化适时调整着装。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 202, 'prompt_tokens': 2719, 'total_tokens': 2921, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-0a5ef83b-3817-93cd-85d2-d52e68ade44c', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--1cacbc54-4977-40a3-b57e-0df8cb3e7d5d-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2719, 'output_tokens': 202, 'total_tokens': 2921, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-09-01 21:59:44,341 - __main__ - INFO - get_system_info接口，接受到前端用户请求
2025-09-01 21:59:44,345 - __main__ - INFO - 返回当前系统状态信息:sessions_count=1 active_users=['user_1756734326']
2025-09-01 21:59:53,405 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:user_1756735184
2025-09-01 21:59:53,407 - __main__ - ERROR - 用户 user_1756735184 的会话不存在
2025-09-01 22:00:12,808 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='user_1756735184' query='3乘以4等于多少' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-09-01 22:00:16,442 - __main__ - INFO - 最终智能体回复结果:session_id='23f9b2dd-bcc3-4ac3-a4bc-1907917605ad' status='completed' timestamp=1756735216.442246 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='1b9ffbe7-53b2-4710-b72a-1b96381d3532'), HumanMessage(content='3乘以4等于多少', additional_kwargs={}, response_metadata={}, id='5a23a8e5-b3a0-4e1f-8dab-0646c88a6a08'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_1d3a17ca7378428598aa26', 'function': {'arguments': '{"a": 3, "b": 4}', 'name': 'multiply'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 2349, 'total_tokens': 2374, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-046fc955-db4e-92bd-add1-daafb4b44024', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--b06d2757-7683-48cb-85bc-8e7ee5371922-0', tool_calls=[{'name': 'multiply', 'args': {'a': 3, 'b': 4}, 'id': 'call_1d3a17ca7378428598aa26', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2349, 'output_tokens': 25, 'total_tokens': 2374, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), ToolMessage(content='3.0乘以4.0等于12.0。', name='multiply', id='896e43ab-c5aa-45e8-b64a-05ed8c0296a8', tool_call_id='call_1d3a17ca7378428598aa26'), AIMessage(content='3乘以4等于12。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 10, 'prompt_tokens': 2393, 'total_tokens': 2403, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-56c62294-25e0-9e62-adbb-305931dc6f22', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--171b7d9f-25c1-4c14-9aaa-f615a1ae602e-0', usage_metadata={'input_tokens': 2393, 'output_tokens': 10, 'total_tokens': 2403, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}})]} interrupt_data=None
2025-09-01 22:00:18,492 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:user_1756735184
2025-09-01 22:00:18,495 - __main__ - INFO - 返回当前用户的状态:user_id='user_1756735184' session_id='23f9b2dd-bcc3-4ac3-a4bc-1907917605ad' status='completed' message=None last_query='3乘以4等于多少' last_updated=1756735216.444836 last_response=AgentResponse(session_id='23f9b2dd-bcc3-4ac3-a4bc-1907917605ad', status='completed', timestamp=1756735216.442246, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': '1b9ffbe7-53b2-4710-b72a-1b96381d3532'}, {'content': '3乘以4等于多少', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '5a23a8e5-b3a0-4e1f-8dab-0646c88a6a08', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_1d3a17ca7378428598aa26', 'function': {'arguments': '{"a": 3, "b": 4}', 'name': 'multiply'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 25, 'prompt_tokens': 2349, 'total_tokens': 2374, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-046fc955-db4e-92bd-add1-daafb4b44024', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--b06d2757-7683-48cb-85bc-8e7ee5371922-0', 'example': False, 'tool_calls': [{'name': 'multiply', 'args': {'a': 3, 'b': 4}, 'id': 'call_1d3a17ca7378428598aa26', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2349, 'output_tokens': 25, 'total_tokens': 2374, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '3.0乘以4.0等于12.0。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'multiply', 'id': '896e43ab-c5aa-45e8-b64a-05ed8c0296a8', 'tool_call_id': 'call_1d3a17ca7378428598aa26', 'artifact': None, 'status': 'success'}, {'content': '3乘以4等于12。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 10, 'prompt_tokens': 2393, 'total_tokens': 2403, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-56c62294-25e0-9e62-adbb-305931dc6f22', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--171b7d9f-25c1-4c14-9aaa-f615a1ae602e-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2393, 'output_tokens': 10, 'total_tokens': 2403, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-09-01 22:01:49,876 - __main__ - INFO - invoke_agent接口，接受到前端用户请求:user_id='user_1756735184' query='3*4' system_message='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。'
2025-09-01 22:01:54,861 - __main__ - INFO - 最终智能体回复结果:session_id='23f9b2dd-bcc3-4ac3-a4bc-1907917605ad' status='completed' timestamp=1756735314.8606725 message=None result={'messages': [SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='1b9ffbe7-53b2-4710-b72a-1b96381d3532'), HumanMessage(content='3乘以4等于多少', additional_kwargs={}, response_metadata={}, id='5a23a8e5-b3a0-4e1f-8dab-0646c88a6a08'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_1d3a17ca7378428598aa26', 'function': {'arguments': '{"a": 3, "b": 4}', 'name': 'multiply'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 2349, 'total_tokens': 2374, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-046fc955-db4e-92bd-add1-daafb4b44024', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--b06d2757-7683-48cb-85bc-8e7ee5371922-0', tool_calls=[{'name': 'multiply', 'args': {'a': 3, 'b': 4}, 'id': 'call_1d3a17ca7378428598aa26', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2349, 'output_tokens': 25, 'total_tokens': 2374, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), ToolMessage(content='3.0乘以4.0等于12.0。', name='multiply', id='896e43ab-c5aa-45e8-b64a-05ed8c0296a8', tool_call_id='call_1d3a17ca7378428598aa26'), AIMessage(content='3乘以4等于12。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 10, 'prompt_tokens': 2393, 'total_tokens': 2403, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-56c62294-25e0-9e62-adbb-305931dc6f22', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--171b7d9f-25c1-4c14-9aaa-f615a1ae602e-0', usage_metadata={'input_tokens': 2393, 'output_tokens': 10, 'total_tokens': 2403, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}), SystemMessage(content='你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', additional_kwargs={}, response_metadata={}, id='2b1b3707-933c-44a4-a2ef-4fcb94996830'), HumanMessage(content='3*4', additional_kwargs={}, response_metadata={}, id='2d1d8ff0-464c-469b-a46f-c523f0c8e9ed'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_3fdfdb56d7c645548f6749', 'function': {'arguments': '{"a": 3, "b": 4}', 'name': 'multiply'}, 'type': 'function', 'index': 0}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 2432, 'total_tokens': 2457, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-86fa21cb-70e2-9715-87b2-5a8a247a8403', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--3273a12a-eed2-45ee-86e5-73d59078854f-0', tool_calls=[{'name': 'multiply', 'args': {'a': 3, 'b': 4}, 'id': 'call_3fdfdb56d7c645548f6749', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2432, 'output_tokens': 25, 'total_tokens': 2457, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}), ToolMessage(content='3.0乘以4.0等于12.0。', name='multiply', id='db6c79e4-3580-4df9-9673-bba6be3c63af', tool_call_id='call_3fdfdb56d7c645548f6749'), AIMessage(content='3乘以4的结果是12。如果您不需要使用工具来计算，请告诉我。', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 20, 'prompt_tokens': 2476, 'total_tokens': 2496, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-18064292-6f17-98cc-b5d8-32bbe91008bd', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--793f41da-67f2-4387-bc75-ccd41394fe73-0', usage_metadata={'input_tokens': 2476, 'output_tokens': 20, 'total_tokens': 2496, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}})]} interrupt_data=None
2025-09-01 22:01:56,917 - __main__ - INFO - get_agent_status接口，接受到前端用户请求:user_1756735184
2025-09-01 22:01:56,920 - __main__ - INFO - 返回当前用户的状态:user_id='user_1756735184' session_id='23f9b2dd-bcc3-4ac3-a4bc-1907917605ad' status='completed' message=None last_query='3*4' last_updated=1756735314.8628376 last_response=AgentResponse(session_id='23f9b2dd-bcc3-4ac3-a4bc-1907917605ad', status='completed', timestamp=1756735314.8606725, message=None, result={'messages': [{'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': '1b9ffbe7-53b2-4710-b72a-1b96381d3532'}, {'content': '3乘以4等于多少', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '5a23a8e5-b3a0-4e1f-8dab-0646c88a6a08', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_1d3a17ca7378428598aa26', 'function': {'arguments': '{"a": 3, "b": 4}', 'name': 'multiply'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 25, 'prompt_tokens': 2349, 'total_tokens': 2374, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-046fc955-db4e-92bd-add1-daafb4b44024', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--b06d2757-7683-48cb-85bc-8e7ee5371922-0', 'example': False, 'tool_calls': [{'name': 'multiply', 'args': {'a': 3, 'b': 4}, 'id': 'call_1d3a17ca7378428598aa26', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2349, 'output_tokens': 25, 'total_tokens': 2374, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '3.0乘以4.0等于12.0。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'multiply', 'id': '896e43ab-c5aa-45e8-b64a-05ed8c0296a8', 'tool_call_id': 'call_1d3a17ca7378428598aa26', 'artifact': None, 'status': 'success'}, {'content': '3乘以4等于12。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 10, 'prompt_tokens': 2393, 'total_tokens': 2403, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-56c62294-25e0-9e62-adbb-305931dc6f22', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--171b7d9f-25c1-4c14-9aaa-f615a1ae602e-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2393, 'output_tokens': 10, 'total_tokens': 2403, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}, {'content': '你会使用工具来帮助用户。如果工具使用被拒绝，请提示用户。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'system', 'name': None, 'id': '2b1b3707-933c-44a4-a2ef-4fcb94996830'}, {'content': '3*4', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'human', 'name': None, 'id': '2d1d8ff0-464c-469b-a46f-c523f0c8e9ed', 'example': False}, {'content': '', 'additional_kwargs': {'tool_calls': [{'id': 'call_3fdfdb56d7c645548f6749', 'function': {'arguments': '{"a": 3, "b": 4}', 'name': 'multiply'}, 'type': 'function', 'index': 0}], 'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 25, 'prompt_tokens': 2432, 'total_tokens': 2457, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 2048}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-86fa21cb-70e2-9715-87b2-5a8a247a8403', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--3273a12a-eed2-45ee-86e5-73d59078854f-0', 'example': False, 'tool_calls': [{'name': 'multiply', 'args': {'a': 3, 'b': 4}, 'id': 'call_3fdfdb56d7c645548f6749', 'type': 'tool_call'}], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2432, 'output_tokens': 25, 'total_tokens': 2457, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}}, {'content': '3.0乘以4.0等于12.0。', 'additional_kwargs': {}, 'response_metadata': {}, 'type': 'tool', 'name': 'multiply', 'id': 'db6c79e4-3580-4df9-9673-bba6be3c63af', 'tool_call_id': 'call_3fdfdb56d7c645548f6749', 'artifact': None, 'status': 'success'}, {'content': '3乘以4的结果是12。如果您不需要使用工具来计算，请告诉我。', 'additional_kwargs': {'refusal': None}, 'response_metadata': {'token_usage': {'completion_tokens': 20, 'prompt_tokens': 2476, 'total_tokens': 2496, 'completion_tokens_details': None, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'qwen-max', 'system_fingerprint': None, 'id': 'chatcmpl-18064292-6f17-98cc-b5d8-32bbe91008bd', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, 'type': 'ai', 'name': None, 'id': 'run--793f41da-67f2-4387-bc75-ccd41394fe73-0', 'example': False, 'tool_calls': [], 'invalid_tool_calls': [], 'usage_metadata': {'input_tokens': 2476, 'output_tokens': 20, 'total_tokens': 2496, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}}]}, interrupt_data=None)
2025-09-01 22:02:49,055 - __main__ - INFO - 关闭服务并完成资源清理
2026-02-15 20:40:09,077 - 01_backendServer - INFO - Redis初始化成功
2026-02-15 20:40:09,830 - utils.llms - INFO - 成功初始化 qwen LLM
2026-02-15 20:40:09,832 - 01_backendServer - INFO - Chat模型初始化成功
2026-02-15 20:40:10,014 - 01_backendServer - INFO - Checkpointer初始化成功
2026-02-15 20:40:10,423 - 01_backendServer - INFO - Agent初始化成功
2026-02-15 20:40:10,424 - 01_backendServer - INFO - 服务完成初始化并启动服务
2026-02-15 20:41:51,895 - 01_backendServer - INFO - 关闭服务并完成资源清理
2026-02-15 20:42:07,314 - 01_backendServer - INFO - Redis初始化成功
2026-02-15 20:42:08,026 - utils.llms - INFO - 成功初始化 qwen LLM
2026-02-15 20:42:08,029 - 01_backendServer - INFO - Chat模型初始化成功
2026-02-15 20:42:08,138 - 01_backendServer - INFO - Checkpointer初始化成功
2026-02-15 20:42:08,545 - 01_backendServer - INFO - Agent初始化成功
2026-02-15 20:42:08,547 - 01_backendServer - INFO - 服务完成初始化并启动服务
2026-02-15 20:42:08,549 - 01_backendServer - INFO - 关闭服务并完成资源清理
2026-02-15 20:42:34,266 - 01_backendServer - INFO - Redis初始化成功
2026-02-15 20:42:35,185 - utils.llms - INFO - 成功初始化 qwen LLM
2026-02-15 20:42:35,187 - 01_backendServer - INFO - Chat模型初始化成功
2026-02-15 20:42:35,381 - 01_backendServer - INFO - Checkpointer初始化成功
2026-02-15 20:42:35,813 - 01_backendServer - INFO - Agent初始化成功
2026-02-15 20:42:35,815 - 01_backendServer - INFO - 服务完成初始化并启动服务
2026-02-15 20:43:00,627 - 01_backendServer - INFO - 关闭服务并完成资源清理
2026-02-15 20:43:25,210 - __main__ - INFO - Redis初始化成功
2026-02-15 20:43:25,890 - utils.llms - INFO - 成功初始化 qwen LLM
2026-02-15 20:43:25,892 - __main__ - INFO - Chat模型初始化成功
2026-02-15 20:43:55,896 - __main__ - ERROR - 初始化失败: couldn't get a connection after 30.00 sec
2026-02-15 20:43:55,904 - __main__ - INFO - 关闭服务并完成资源清理
2026-02-15 20:48:22,548 - __main__ - INFO - Redis初始化成功
2026-02-15 20:48:23,244 - utils.llms - INFO - 成功初始化 qwen LLM
2026-02-15 20:48:23,246 - __main__ - INFO - Chat模型初始化成功
2026-02-15 20:48:53,261 - __main__ - ERROR - 初始化失败: couldn't get a connection after 30.00 sec
2026-02-15 20:48:53,266 - __main__ - INFO - 关闭服务并完成资源清理
2026-02-15 20:50:52,168 - 01_backendServer - INFO - Redis初始化成功
2026-02-15 20:50:52,868 - utils.llms - INFO - 成功初始化 qwen LLM
2026-02-15 20:50:52,869 - 01_backendServer - INFO - Chat模型初始化成功
2026-02-15 20:51:22,892 - 01_backendServer - ERROR - 初始化失败: couldn't get a connection after 30.00 sec
2026-02-15 20:51:22,896 - 01_backendServer - INFO - 关闭服务并完成资源清理
